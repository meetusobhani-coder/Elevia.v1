<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Elevia â€” Calculator</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
<header class="site-header">
  <h1 class="site-title">Elevia</h1>
  <button id="signOutBtn" class="signout-btn" style="display:none;">Sign Out</button>
</header>

<!-- Sign In / Sign Up Popup -->
<div id="auth-popup" class="popup-overlay">
  <div class="popup-box">
    <h2>Welcome to Elevia âœ¨</h2>
    <input type="text" id="name" placeholder="Full Name" class="popup-input" />
    <input type="email" id="email" placeholder="Email" class="popup-input" />
    <button onclick="signInUser()" class="popup-btn">Continue</button>
  </div>
</div>

<main class="main-center">
  <section class="calculator-wrap">
    <h2 class="calc-intro">Discover your readiness to manifest your desires. Adjust your intention, focus, and energy levels to see your manifestation readiness score!</h2>

   <form id="manifestationForm" class="calc-form" onsubmit="return false;">
    <label>âœ¨ Intention
        <select id="intention">
          <option value="">â€” Select intention â€”</option>
          <option value="Love">Love</option>
          <option value="Career">Career</option>
          <option value="Family">Family</option>
          <option value="Health">Health</option>
          <option value="Wealth">Wealth</option>
          <option value="Self">Self-Growth</option>
        </select>
        <small>Choose your main focus for manifestation.</small>
      </label>

      <label>â³ Timing Readiness (1â€“10)
        <select id="timing">
          <option value="">â€” Select 1â€“10 â€”</option>
          <option value="1">1 (Low)</option><option value="2">2</option><option value="3">3</option>
          <option value="4">4</option><option value="5">5</option><option value="6">6</option>
          <option value="7">7</option><option value="8">8</option><option value="9">9</option>
          <option value="10">10 (High)</option>
        </select>
        <small>Is now the right time for this wish?</small>
      </label>

      <label>ğŸƒ Action Alignment (1â€“10)
        <select id="action">
          <option value="">â€” Select 1â€“10 â€”</option>
          <option value="1">1 (Low)</option><option value="2">2</option><option value="3">3</option>
          <option value="4">4</option><option value="5">5</option><option value="6">6</option>
          <option value="7">7</option><option value="8">8</option><option value="9">9</option>
          <option value="10">10 (High)</option>
        </select>
        <small>Are your actions aligned with your wish?</small>
      </label>

      <label>ğŸ¯ Milestone Clarity (1â€“10)
        <select id="clarity">
          <option value="">â€” Select 1â€“10 â€”</option>
          <option value="1">1 (Low)</option><option value="2">2</option><option value="3">3</option>
          <option value="4">4</option><option value="5">5</option><option value="6">6</option>
          <option value="7">7</option><option value="8">8</option><option value="9">9</option>
          <option value="10">10 (High)</option>
        </select>
        <small>How clear is your goal?</small>
      </label>

      <label>ğŸŒˆ Patience Level
        <select id="patience">
          <option value="">â€” Select â€”</option>
          <option value="Low">Low</option>
          <option value="Medium">Medium</option>
          <option value="High">High</option>
        </select>
        <small>How calm can you stay if things donâ€™t go perfectly?</small>
      </label>

      <label>â¤ï¸ Emotional Energy (Â°)
        <select id="phi">
          <option value="">â€” Select â€”</option>
          <option value="0">0Â° (Low)</option>
          <option value="180">180Â° (Moderate)</option>
          <option value="360">360Â° (High)</option>
        </select>
        <small>How emotionally charged are you for this wish?</small>
      </label>



      <div class="buttons-row">
        <button type="button" id="calculateBtn">Calculate</button>
        <button type="button" id="resetBtn">Reset</button>
      </div>

      <div class="buttons-row">
        <a href="index.html" class="btn">Back to Home</a>
        <a href="details.html" class="btn">Go to Consulting</a>
      </div>
    </form>

    <div id="result" class="result-panel" style="display:none;"></div>

    <div id="adminPanel" style="display:none; margin-top:20px;">
      <button id="downloadDataBtn" class="btn">Download All Data (CSV)</button>
    </div>
  </section>
</main>

<footer class="site-footer"><p>Â© 2025 Elevia</p></footer>

<script>
const SUPABASE_URL = "https://dvvktlngsiqerhsikfna.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR2dmt0bG5nc2lxZXJoc2lrZm5hIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI4NTI5ODksImV4cCI6MjA3ODQyODk4OX0.IGIeZLmEWwUsof-Fj_vIAHhhlvIFN-yjVjHsJHluBcM";
const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

// -------- AUTH --------
async function signInUser() {
  const name = document.getElementById('name').value.trim();
  const email = document.getElementById('email').value.trim();
  if (!name || !email) return alert("Please enter name and email.");

  // Save locally to keep logged in
  localStorage.setItem("userEmail", email);
  localStorage.setItem("userName", name);

  // Add user to Supabase
  await supabase.from("Users").upsert([{ name, email }]);

  document.getElementById('auth-popup').style.display = 'none';
  document.getElementById('signOutBtn').style.display = 'inline-block';

  if (email === "admin@elevia.com") document.getElementById('adminPanel').style.display = 'block';
}

// Show popup only first time
window.onload = function() {
  const user = localStorage.getItem("userEmail");
  if (user) {
    document.getElementById('auth-popup').style.display = 'none';
    document.getElementById('signOutBtn').style.display = 'inline-block';
    if (user === "admin@elevia.com") document.getElementById('adminPanel').style.display = 'block';
  } else {
    document.getElementById('auth-popup').style.display = 'flex';
  }
};

document.getElementById("signOutBtn").onclick = () => {
  localStorage.clear();
  location.reload();
};

// -------- CALCULATE --------
document.getElementById("calculateBtn").onclick = async () => {
  const name = localStorage.getItem("userName");
  const email = localStorage.getItem("userEmail");

  const intention = document.getElementById("intention").value;
  const timing = parseInt(document.getElementById("timing").value);
  const action = parseInt(document.getElementById("action").value);
  const clarity = parseInt(document.getElementById("clarity").value);
  const patience = document.getElementById("patience").value;
  const phi = parseInt(document.getElementById("phi").value);

  if (!intention || !timing || !action || !clarity || !patience || !phi) {
    alert("Please fill out all fields.");
    return;
  }

  // Calculate simple weighted score
  let patienceVal = patience === "High" ? 10 : patience === "Medium" ? 6 : 3;
  let score = Math.round((timing + action + clarity + patienceVal + phi/36) / 5);

  // Personalized message
  let message = "";
  if (score >= 8) message = `âœ¨ ${name}, your manifestation energy for ${intention} is radiating strongly! Keep believing â€” the universe is aligning in your favor.`;
  else if (score >= 5) message = `ğŸŒ± ${name}, you're halfway there with your ${intention} manifestation. Reflect, realign your focus, and watch how things shift.`;
  else message = `ğŸ’« ${name}, your energy feels scattered right now for ${intention}. Take small consistent steps and rebuild clarity â€” the spark will return.`;

  document.getElementById("result").style.display = "block";
  document.getElementById("result").innerHTML = `<h3>Your Manifestation Score: ${score}/10</h3><p>${message}</p>`;

  // Store in Supabase
  const created_at = new Date().toISOString();
  await supabase.from("Calculations").insert([{ 
    user_email: email, intention, timing, action, clarity, patience, phi, score, result_message: message, created_at 
  }]);
};

// -------- RESET --------
document.getElementById("resetBtn").onclick = () => {
  document.getElementById("manifestationForm").reset();
  document.getElementById("result").style.display = "none";
};

// -------- ADMIN DOWNLOAD --------
document.getElementById("downloadDataBtn").onclick = async () => {
  const { data, error } = await supabase.from("Calculations").select("*");
  if (error) return alert("Error fetching data.");

  let csv = "User Email,Intention,Timing,Action,Clarity,Patience,Phi,Score,Message,Date\n";
  data.forEach(row => {
    csv += `${row.user_email},${row.intention},${row.timing},${row.action},${row.clarity},${row.patience},${row.phi},${row.score},"${row.result_message}",${row.created_at}\n`;
  });

  const blob = new Blob([csv], { type: 'text/csv' });
  const url = window.URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "Elevia_Calculations.csv";
  a.click();
};
</script>

<style>
body {font-family: Poppins, sans-serif; background:#f3f5f9; color:#1f2937; text-align:center;}
.site-header{display:flex;justify-content:center;align-items:center;position:relative;padding:1rem;}
.signout-btn{position:absolute;right:10px;background:#ff7675;color:#fff;border:none;padding:6px 12px;border-radius:8px;cursor:pointer;}
.popup-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);display:flex;justify-content:center;align-items:center;}
.popup-box{background:#fff;padding:20px;border-radius:12px;width:300px;}
.popup-input{width:90%;margin:8px;padding:8px;border:1px solid #ddd;border-radius:8px;}
.popup-btn{background:#6366f1;color:white;border:none;padding:8px 12px;border-radius:8px;cursor:pointer;}
.calc-form label{display:block;margin:10px 0;}
select{padding:5px;border-radius:6px;}
.buttons-row{margin:10px 0;}
.btn,button{background:#6366f1;color:#fff;border:none;border-radius:8px;padding:8px 16px;cursor:pointer;margin:4px;}
.result-panel{background:#fff;border-radius:12px;padding:15px;margin-top:10px;box-shadow:0 2px 6px rgba(0,0,0,0.1);}
</style>
</body>
</html>
